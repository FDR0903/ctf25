\documentclass[handout,8pt]{beamer}

\usetheme{CambridgeUS}
%\setbeameroption{show notes}

\usepackage{tabularx,color,colortbl}
\usepackage{amsmath,amsfonts,amssymb}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%load minimum set of other required packages
\usepackage{amsfonts}
\usepackage{amsmath}
\usepackage{amssymb}
\usepackage{amsthm}
\usepackage{array}
\usepackage{bbm}
\usepackage{booktabs,longtable}
\usepackage{eurosym}
\usepackage{floatrow}
\usepackage{graphicx}
\usepackage{hyperref}
\usepackage{harvard}
\usepackage[english]{babel}
\usepackage{multirow}
\usepackage{lscape}
\usepackage{pdflscape}
\usepackage{rotating}
\usepackage{subfig}
\usepackage{setspace}
\usepackage{titlesec}
\usepackage{verbatim}
\usepackage{xcolor}
\usepackage[T1]{fontenc}

\usepackage[utf8]{inputenc}

\usepackage{multirow}

%\usepackage{pgfpages}
%\pgfpageuselayout{resize to}[a4paper,border,shrink=5mm,landscape]

\setbeameroption{show notes} %un-comment to see the notes
\setbeamertemplate{note page}[plain]

\makeatother
\setbeamertemplate{footline}
{
  \leavevmode%
  \hbox{%
  \begin{beamercolorbox}[wd=.4\paperwidth,ht=2.25ex,dp=1ex,center]{author in head/foot}%
    \usebeamerfont{author in head/foot}\insertshortauthor
  \end{beamercolorbox}%
  \begin{beamercolorbox}[wd=.6\paperwidth,ht=2.25ex,dp=1ex,center]{title in head/foot}%
    \usebeamerfont{title in head/foot}\insertshorttitle\hspace*{3em}
    \insertframenumber{} / \inserttotalframenumber\hspace*{1ex}
  \end{beamercolorbox}}%
  \vskip0pt%
}
\makeatletter
\setbeamertemplate{navigation symbols}{}


\newcommand{\E}{\mathbb{E}}
\newcommand{\var}{\mathrm{Var}}
\newcommand{\p}{\mathbb{P}}
\newcommand{\f}{\mathcal{F}}
\newcommand{\cov}{\mathrm{Cov}}
\newcommand{\corr}{\mathrm{Corr}}
\newcommand{\R}{\mathbb{R}}
\newcommand{\N}{\mathcal{N}}
\newcommand{\USD}{\text{USD}}
\newcommand{\HC}{\text{HC}}
\newcommand{\FC}{\text{HC}}

\newcommand{\textred}{\textcolor{red}}
\newcolumntype{H}{>{\columncolor[rgb]{1.00,1.00,0.00}}c}

\setbeamertemplate{footline}[frame number]


% itemize options
\let\OLDitemize\itemize
\renewcommand\itemize{\OLDitemize\addtolength{\itemsep}{10pt}}

\setbeamertemplate{itemize/enumerate body begin}{\large}
\setbeamertemplate{itemize/enumerate subbody begin}{\large}

\makeatletter
\define@key{beamerframe}{wide}[30pt]{%
  \def\beamer@cramped{\itemsep #1\topsep0.5pt\relax}}
\makeatother


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% and tikz
\usepackage{tikz}
\usetikzlibrary{decorations.pathreplacing}
	\definecolor{cinnabar}{rgb}{0.89, 0.26, 0.2}
	\definecolor{ceruleanblue}{rgb}{0.16, 0.32, 0.75}

\usetikzlibrary{patterns}
\usetikzlibrary{matrix}
\usetikzlibrary{arrows,backgrounds,decorations}

\newcommand*\circled[1]{\tikz[baseline=(char.base)]{
            \node[shape=circle,draw,inner sep=2pt] (char) {#1};}}


% ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- %
% ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- %
% ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- %




\title{Continuous Time Finance: Solution Exercise Set 4}
\author{\textbf{Paul Whelan}}
\institute{Copenhagen Business School}
\date{2021}

\begin{document}

\begin{frame}
     \titlepage
\end{frame}


% ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- %
% ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- %
% ------------------------------------------------------------------------------------------------------------------------------------------------------------------------- %




\begin{frame}[allowframebreaks]{ }



\begin{enumerate}
    \item \textbf{Heston Model} \\
    Suppose that under the risk-neutral measure $\Tilde{P}$, a stock price follows:
    \begin{equation}
        dS(t) = rS(t) dt + \sqrt{V(t)} S(t) d\Tilde{W}_1(t),
    \end{equation}
    where $r$ is constant and the volatility $\sqrt{V(t)}$ is itself a stochastic process:
    \begin{equation}
        dV(t) = (a - bV(t)) dt + \sigma \sqrt{V(t)} d\Tilde{W}_2(t),
    \end{equation}
    where $a,b$ and $\sigma$ are positive constants, and $\Tilde{W}_1(t)$ and $\Tilde{W}_2(t)$ are correlated Brownian motions under $\Tilde{P}$, with
    \begin{equation*}
        d\Tilde{W}_1(t) d\Tilde{W}_2(t) = \rho dt,
    \end{equation*}
    for some $\rho\in(-1,1)$. The two-dimensional process $(S(t), V(t))$, governed by the SDEs (1) and (2), is a Markov process.\newline
    
    \newpage
    
    The risk-neutral price of a call expiring at time $T>t$ is:
    \begin{equation*}
        c(t,S(t), V(t)) = \Tilde{E}\left[e^{-r(T-t)}(S(T)-K)^+\right].
    \end{equation*}
    
    This problem shows that the function $c(t,s,v)$ satisfies the PDE:
    \begin{equation}
        c_t + rsc_s + (a-bv)c_v + \frac{1}{2}s^2 vc_{ss} + \rho \sigma svc_{sv} + \frac{1}{2}\sigma^2 vc_{vv} = rc,
    \end{equation}
    with boundary condition
    \begin{equation}
        c(T,s,v) = (s-K)^+ \textit{ for all } s\geq 0, v\geq 0. 
    \end{equation}
    
    \begin{enumerate}
        \item Show that $e^{-rt}c(t,S(t),V(t))$ is a martingale under $\Tilde{P}$ and use this fact to obtain the PDE (3).\newline
        
        $e^{-rt}c(t,S(t),V(t)) = \Tilde{E}[e^{rT}(S(T)-K)^+|\mathcal{F}_t]$ is a martingale by iterated conditioning argument: \newline
        \begin{align*}
            & d(e^{-rt}c(t,S_t,V_t)) = e^{-rt}\bigg[-rc(t,S_t,V_t) + c_t(t,S_t,V_t) + c_s(t,S_t,V_t)rS_t \\
            & + c_v(t,S_t,V_t)(a-bV_t) + \frac{1}{2}c_{ss}(t,S_t,V_t)V_tS_t^2 \\
            &+ \frac{1}{2}c_{vv}(t,S_t,V_t)\sigma^2V_t + c_{sv}(t,S_t,V_t)\sigma V_tS_t\rho\bigg] dt\\
            &+\textit{martingale term.}
        \end{align*}
        Setting the $dt$ term to zero, we obtain
        \begin{equation*}
            c_t + rsc_s + (a-bv)c_v + \frac{1}{2}s^2vc_{ss} + \rho\sigma svc_{sv} + \frac{1}{2}\sigma^2vc_{vv} = rc,
        \end{equation*}
        which is equation (3).
    
    	\vspace*{1.5cm}
	
        \item  Suppose there are functions $f(t,x,v)$ and $g(t,x,v)$ satisfying
        \begin{align}
            f_t + \left(r + \frac{1}{2}v\right) f_x + (a - bv + \rho \sigma v) f_v + \frac{1}{2}vf_{xx} + \rho\sigma v f_{xv} + \frac{1}{2}\sigma^2 v f_{vv} &= 0,\\
            g_t + \left(r - \frac{1}{2}v\right) g_x + (a - bv) g_v + \frac{1}{2}vg_{xx} + \rho \sigma v g_{xv} + \frac{1}{2}\sigma^2 vg_{vv} &=0.
        \end{align}
        
        Show that if we define
        \begin{equation}
            c(t,s,v) = sf(t,\log s, v) - e^{-r(T-t)}Kg(t,\log s, v),
        \end{equation}
        
        then $c(t,s,v)$ satisfies the PDE (3).\newline
        
        \newpage
        
        From (7) we can compute the partial derivatives of $c(t,s,v)$: 
        
        \begin{align*}
            c_t &= sf_t(t,\log s,v) - re^{-r(T-t)}Kg(t,\log s, v) - e^{-r(T-t)}Kg_t(t,\log s, v),\\
            c_s &= f(t,\log s,v) + sf_s(t,\log s,v)\frac{1}{s} - e^{-r(T-t)}Kg_s(t,\log s, v)\frac{1}{s},\\
            c_v &= sf_v(t,\log s,v) - e^{-r(T-t)}Kg_v(t,\log s, v),\\
            c_{ss} &=f_s(t,\log s,v)\frac{1}{s} + f_{ss}(t,\log s,v)\frac{1}{s} - e^{-r(T-t)}Kg_{ss}(t,\log s,v)\frac{1}{s^2} \\
            &+ e^{-r(T-t)}Kg_s(t,\log s,v)\frac{1}{s^2},\\
            c_{vv} &=sf_{vv}(t,\log s,v) - e^{-r(T-t)}Kg_{vv}(t,\log s,v),\\
            c_{sv} &= f_v(t,\log s,v) + f_{sv}(t,\log s,v) - e^{-r(T-t)}Kg_{sv}(t,\log s,v)\frac{1}{s}.
        \end{align*}
        Substituting these partial derivatives in the left-hand side of (3) and then using (5) and (6) we find $r s f(t,\log s,v) - r e^{-r(T-t)} K g(t,\log s,v)$, which is equal to $rc$, as we wanted to show.
        
        \newpage
        \vspace*{1cm}
        
        \item Suppose a pair of processes $(X(t), V(t))$ is governed by the SDEs:
        \begin{align}
            dX(t) &= \left(r + \frac{1}{2}V(t) \right) dt + \sqrt{V(t)} dW_1(t),\\
            dV(t) &= (a - bV(t) + \rho \sigma V(t)) dt + \sigma\sqrt{V(t)} dW_2(t),
        \end{align}
        where $W_1(t)$ and $W_2(t)$ are Brownian motions under some probability measure $P$ with $dW_1(t)dW_2(t) = \rho dt$. \newline 
        
        Define
        \begin{equation*}
            f(t,x,v)=E^{t,x,v}\left[\mathbbm{1}_{\{X(T)\geq \log K\}}\right].
        \end{equation*}
        
        Show that $f(t,x,v)$ satisfies the PDE (5) and the boundary condition
        
        \begin{equation*}
            f(T,x,v) = \mathbbm{1}_{\{x\geq\log K\}}, \textit{ for all } x\in \mathbb{R} \textit{ and } v\geq 0.
        \end{equation*}
        
	\newpage
	
        First, by Markov property, $f(t,X(t),V(t))=E[\mathbbm{1}_{\{X(T)\geq\log K\}}|\mathcal{F}_t]$.\newline
        
        So $f(T,X(T),V(T))=\mathbbm{1}_{\{X(T)\geq\log K\}}$, which implies
        \begin{equation*}
            f(T,x,v)=\mathbbm{1}_{\{x\geq\log K\}}, \textit{ for all } x\in\mathbb{R} \textit{ and } v\geq0.  \\
        \end{equation*}
        
        Second, $f(t,X(t),V(t))$ is a martingale, so by differentiating $f$ and setting the $dt$ term as zero, we have the PDE (5) for $f$. Indeed, \newline
        
        \begin{align*}
            df(t,X_t,V_t) = &\bigg[f_t(t,X_t,V_t) + f_x(t,X_t,V_t) \left(r + \frac{1}{2}V_t\right) \\
            & + f_v(t,X_t,V_t) (a-bV_t+\rho\sigma V_t) +\frac{1}{2}f_{xx}(t,X_t,V_t)V_t  \\
            & + \frac{1}{2}f_{vv}(t,X_t,V_t)\sigma^2V_t + f_{xv}(t,X_t,V_t)\sigma V_t\rho\bigg] dt\\
            &+\textit{martingale term.}
        \end{align*}
        So we must have,
        \begin{equation*}
            f_t + \left(r+\frac{1}{2}v\right)f_x + (a-bv+\rho\sigma v)f_v + \frac{1}{2}vf_{xx} + \rho\sigma vf_{xv} + \frac{1}{2}\sigma^2vf_{vv} = 0,
        \end{equation*}
        which is exactly the PDE (5). \newline
        
        \newpage
        
        
        \item Suppose a pair of processes $(X(t), V(t))$ is governed by the SDEs:
        \begin{align}
            dX(t) &= \left( r - \frac{1}{2}V(t) \right) dt + \sqrt{V(t)} dW_1(t),\\
            dV(t) &= (a - bV(t)) dt + \sigma\sqrt{V(t)} dW_2(t),
        \end{align}
        where $W_1(t)$ and $W_2(t)$ are Brownian motions under some probability measure $P$ with $dW_1(t) dW_2(t) = \rho dt$. \newline
        
        Define
        \begin{equation*}
            g(t,x,v) = E^{t,x,v}\left[\mathbbm{1}_{\{X(T)\geq\log K\}}\right].
        \end{equation*}
        
        Show that $g(t,x,v)$ satisfied the PDE (6) and the boundary condition
        
        \begin{equation*}
            g(T,x,v) = \mathbbm{1}_{\{x\geq \log K\}}, \textit{ for all } x\in\mathbb{R} \textit{ and } v\geq 0.
        \end{equation*}\\
        
        We can follow exactly the same procedure as in (c).
        
        \item Show that with $f(t,x,v)$ and $g(t,x,v)$ as in (c) and (d), the function $c(t,x,v)$ of (7) satisfies the boundary condition (4).\newline
        
        Start from (7) and evaluate it at time $T$:
        \begin{equation*}
            c(T,s,v) = sf(T,\log s,v) - e^{-r(T-T)}Kg(T,\log s,v).
        \end{equation*}
        
        Using the boundary conditions for $f$ and $g$:
        
        \begin{align*}
            c(T,s,v) &= s\mathbbm{1}_{\{\log s\geq\log K\}} - K\mathbbm{1}_{\{\log s\geq\log K\}}\\
            &= (s-K)\mathbbm{1}_{\{\log s\geq \log K\}}\\
            &= (s-K)\mathbbm{1}_{\{s\geq K\}}\\
            &= (s-K)^+,
        \end{align*}
        as we wanted to show.
    \end{enumerate}
    
    \newpage
    
    \item \textbf{Option to exchange an asset for another}\\
    We consider a financial market in which there are two risky assets with prices $S_t^1$ and $S_t^2$ at time $t$ and a riskless asset $S_t^0=e^{rt}$. The stock prices follow the SDEs:
    \begin{align*}
        dS_t^1 &= S_t^1(\mu_1 dt + \sigma_1 dB_t^1),\\
        dS_t^2 &= S_t^2(\mu_2 dt + \sigma_2 dB_t^2),
    \end{align*}
    where $B_t^1$ and $B_t^2$ are two independent Brownian motions defined on a probability space $(\Omega,\mathcal{G},P)$, and denote by $\mathcal{G}_t$ the sigma algebra generated by the Brownian motions up to time $t$.\\
    We study the pricing and hedging of an option giving the right to exchange one of the risky assets for the other at time $T$.
    
    \begin{enumerate}
        \item We set
        \begin{equation*}
            \theta_1=\frac{\mu_1 - r}{\sigma_1} \textit{ and } \theta_2=\frac{\mu_2 - r}{\sigma_2}.
        \end{equation*}
        Show that the process defined by
        \begin{equation*}
            M_t=e^{-\theta_1 B_t^1 -\theta_2 B_t^2 -\frac{1}{2}(\theta_1^2+\theta_2^2)t},
        \end{equation*}
        is a martingale with respect to the filtration $(\mathcal{G}_t)_{t\in[0, T]}$.\\\\
        $M_t$ is a function of time $t$ and the two Brownian motions $B_t^1$ and $B_t^2$. We can compute the differential of $M_t$ using Itô's formula:
        \begin{align*}
            dM_t &= -\frac{1}{2}(\theta_1^2 +\theta_2^2)M_t dt - \theta_1M_t dB_t^1 - \theta_2M_2dB_t^2 +\frac{1}{2}\theta_1^2M_t dt + \frac{1}{2}\theta_2^2M_t dt \\
            &= M_t(-\theta_1 dB_t^1 -\theta_2 dB_t^2).
        \end{align*}
        This has no $dt$ term, so $M_t$ is a martingale.
        
        \item Let $\Tilde{P}$ be the probability with Radon-Nikodym derivative $M_t$ with respect to $P$, i.e.
        \begin{equation*}
            \frac{d\Tilde{P}}{dP} = M_t
        \end{equation*}
        We introduce the processes
        \begin{equation*}
            W_t^1 = B_t^1 + \theta_1 t \textit{ and } W_t^2 = B_t^2 + \theta_2 t.
        \end{equation*}
        Derive, under the probability $\Tilde{P}$, the joint moment generating function of $W_t=(W_t^1, W_t^2)$:
        \begin{equation*}
            \Tilde{E}\left[e^{uW_t}\right].
        \end{equation*}
        Then deduce that, for any $t\in[0,T]$, the random variables $W_t^1$ and $W_t^2$ are independent normal variables with mean zero and variance $t$ and $\Tilde{P}$.\\\\
        The joint moment generating function of $W_t=(W_t^1,W_t^2)$ is:
        \begin{align*}
            \Tilde{E}[e^{uW_t}] &= \Tilde{E}\left[e^{u_1(B_t^1+\theta_1t) + u_2(B_t^2 + \theta_2t)}\right]\\
            &= E\left[M_t e^{u_1(B_t^1 + \theta_1t) + u_2(B_t^2 +\theta_2t)}\right]\\
            &= E\left[e^{-\theta_1B_t^1 - \theta_2B_t^2 - \frac{1}{2}(\theta_1^2 + \theta_2^2)t + u_1(B_t^1 + \theta_1t) + u_2(B_t^2 +\theta_2t)}\right]\\
            &= e^{-\frac{1}{2}(\theta_1^2 + \theta_2^2)t + u_1\theta_1t + u_2\theta_2t}E\left[e^{(u_1 - \theta_1)B_t^1 + (u_2 -\theta_2)B_t^2}\right].
        \end{align*}
        Under $P, B_t^1$ and $B_t^2$ are jointly normal with mean zero and variance $t$. Therefore their joint moment generating function is
        \begin{equation*}
            E[e^{vB_t}]=E\left[e^{v_1B_t^1 + v_2B_t^2}\right] = e^{\frac{1}{2}v_1^2t + \frac{1}{2}v_2^2t}.
        \end{equation*}
        Therefore,
        \begin{align*}
            \Tilde{E}[e^{uW_t}] &= e^{-\frac{1}{2}(\theta_1^2 +\theta_2^2)t + u_1\theta_1t + u_2\theta_2t}e^{\frac{1}{2}(u_1-\theta_1)^2t + \frac{1}{2}(u_2 - \theta_2)^2t}\\
            &= e^{-\frac{1}{2}(\theta_1^2 +\theta_2^2)t + u_1\theta_1t + u_2\theta_2t + \frac{1}{2}(u_1^2-2u_1\theta_1+\theta_1^2)t + \frac{1}{2}(u_2^2 - 2u_2\theta_2 + \theta_2^2)t}\\
            &= e^{\frac{1}{2}u_1^2t + \frac{1}{2}u_2^2t}.
        \end{align*}
        This is the joint moment generating function of two independent normal variables with mean zero and variance $t$, as we wanted to show.
        
        \item Show that, under $\Tilde{P}$, the discounted prices
        \begin{equation*}
            \Tilde{S}_t^1=e^{-rt}S_t^1 \textit{ and } \Tilde{S}_t^2 = e^{-rt} S_t^2
        \end{equation*}
        are martingales.\\
        \begin{align*}
            d\Tilde{S}_t^1 &= d(e^{-rt}S_t^1) = -re^{-rt}S_t^1 dt + e^{-rt} dS_t^1\\
            &= -re^{-rt}S_t^1 dt + e^{-rt}S_t^1(\mu_1 dt + \sigma_1 dB_t^1)\\
            &= e^{-rt}S_t^1(\mu_1 - r) dt + e^{-rt}S_t^1\sigma_1 dB_t^1\\
            &= \Tilde{S}_t^1\sigma_1\theta_1 dt + \Tilde{S}_t^1\sigma_1 dB_t^1\\
            &= \Tilde{S}_t^1\sigma_1(\theta_1 dt + dB_t^1)\\
            &= \Tilde{S}_t^1\sigma_1 dW_t^1.
        \end{align*}
        Therefore, $\Tilde{S}_t^1$ is a martingale under $\Tilde{P}$. The same holds for $\Tilde{S}_t^2$.
    \end{enumerate}
    
    We want to price and hedge a European option, with maturity $T$, giving to the holder the right to exchange one unit of the asset 2 for one unit of the asset 1. From his initial wealth, the premium, the writer of the option builds a strategy, defining at any time $t$ a portfolio made of $H_t^0$ units of the riskless asset and $H_t^1$ and $H_t^2$ units of the assets 1 and 2, respectively, in order to generate, at time $T$, a wealth equal to $(S_T^1-S_T^2)^+$. A trading strategy will be defined by the three adapted processes $H^0, H^1$ and $H^2$.
    \begin{enumerate}
        \setcounter{enumii}{3}
        
        \item Define precisely the self-financing strategy and prove that, if
        \begin{equation*}
            \Tilde{V}_t = e^{-rt} V_t
        \end{equation*}
        is the discounted value of the strategy, we have:
        \begin{equation}
            d\Tilde{V}_t = H_t^1 e^{-rt} S_t^1\sigma_1 dW_t^1 + H_t^2 e^{-rt} S_t^2 \sigma_2 dW_t^2.
        \end{equation}\\
        The value of the portfolio at time $t$ is
        \begin{equation*}
            V_t = H_t^0S_t^0 + H_t^1S_t^1 + H_t^2S_t^2.
        \end{equation*}
        For the portfolio to be self-financing, its differential must be:
        \begin{align*}
            dV_t &= H_t^1 dS_t^1 + H_t^2 dS_t^2 + r(V_t - H_t^1S_t^1 - H_t^2S_t^2) dt\\
            &= H_t^1S_t^1(\mu_1 dt + \sigma_1 dB_t^1) + H_t^2S_t^2(\mu_2 dt + \sigma_2 dB_t^2) + r(V_t - H_t^1S_t^1 - H_t^2S_t^2) dt\\
            &= rV_t dt + H_t^1\sigma_1S_t^1(\theta_1 dt + dB_t^1) + H_t^2\sigma_2S_t^2(\theta_2 dt + dB_t^2)\\
            &= rV_t dt + H_t^1\sigma_1S_t^1 dW_t^1 + H_t^2\sigma_2S_t^2 dW_t^2.
        \end{align*}
        Therefore, the differential of the discounted portfolio value is:
        \begin{align*}
            d\Tilde{V}_t &= -re^{-rt}V_t dt + e^{-rt} dV_t\\
            &= -re^{-rt}V_t dt + e^{-rt}[rV_t dt + H_t^1\sigma_1S_t^1 dW_t^1 + H_t^2\sigma_2S_t^2 dW_t^2]\\
            &= e^{-rt}[H_t^1\sigma_1S_t^1 dW_t^1 + H_t^2\sigma_2S_t^2 dW_t^2]\\
            &= H_t^1e^{-rt}S_t^1\sigma_1 dW_t^1 + H_t^2e^{-rt}S_t^2\sigma_2 dW_t^2,
        \end{align*}
        as we wanted to show.
        
        \item Prove that if a self-financing strategy has terminal value equal to $V_T=(S_T^1-S_T^2)^+$, then its value at any time $t<T$ is given by $V_t=F(t,S_t^1,S_t^2)$, where the function $F$ is defined by:
        \begin{equation}
            F(t,x_1,x_2) = \Tilde{E}\left(x_1e^{\sigma_1(W_T^1-W_t^1)-\frac{\sigma_1^2}{2}(T-t)}-x_2e^{\sigma_2(W_T^2W_t^2)-\frac{\sigma_2^2}{2}(T-t)}\right)^+.
        \end{equation}\\
        If the value at maturity of the self-financing portfolio is equal to the payoff of the option, their value must be equal at any time $t< T$. Using the risk neutral valuation formula we can write:
        \begin{equation*}
            V_t = \Tilde{E}(e^{-r(T-t)}V_T|\mathcal{F}_t) = \Tilde{E}(e^{-r(T-t)}(S_T^1 - S_T^2)^+|\mathcal{F}_t).
        \end{equation*}
        Since $S_t^1$ and $S_t^2$ follow Geometric Brownian Motions, we know that
        \begin{align*}
            S_T^1 &= S_t^1e^{\left(r - \frac{\sigma_1^2}{2}\right)(T-t) + \sigma_1(W_T^1-W_t^1)},\\
            S_T^2 &= S_t^2e^{\left(r - \frac{\sigma_2^2}{2}\right)(T-t) + \sigma_1(W_T^2-W_t^2)}.
        \end{align*}
        Therefore,
        \begin{align*}
            V_t &= \Tilde{E}\left(e^{-r(T-t)}S_t^1e^{\left(r-\frac{\sigma_1^2}{2}\right)(T-t)+\sigma_1(W_T^1-W_t^1)} - e^{-r(T-t)}S_t^2e^{\left(r - \frac{\sigma_2^2}{2}\right) (T-t) + \sigma_2(W_T^2-W_t^2)}\right)^+.\\
            V_t &= \Tilde{E}\left(S_t^1e^{-\frac{\sigma_1^2}{2}(T-t) + \sigma_1(W_T^1-W_t^1)}-S_t^2e^{-\frac{\sigma_2^2}{2}(T-t) + \sigma_2(W_T^2-W_t^2)}\right)^+.
        \end{align*}
        Knowing that $V_t=F(t,S_t^1,S_t^2)$, we can write:
        \begin{equation*}
            F(t,x_1,x_2) = \Tilde{E}\left(x_1e^{\sigma_1(W_T^1-W_t^1)-\frac{\sigma_1^2}{2}(T-t)} - x_2e^{\sigma_2(W_T^2-W_t^2)-\frac{\sigma_2^2}{2}(T-t)}\right)^+.
        \end{equation*}
        
        \item Find a parity relationship between the value of the option with payoff $(S_T^1-S_T^2)^+$ and the symmetrical option $(S_T^2-S_T^1)^+$, similar to the put-call parity relationship and give an example of arbitrage opportunity when this relation does not hold.\\\\
        It is easy to show that
        \begin{equation*}
            (S_T^1-S_T^2)^+ - (S_T^2-S_T^1)^+ = S_T^1 - S_T^2.
        \end{equation*}
        Therefore, buying $S^1$ and selling $S^2$ is equivalent to buying the option with payoff $(S_T^1 - S_T^2)^+$ and selling the option with payoff $(S_T^2 - S_T^1)^+$. In terms of time-$t$ prices, if we denote by $C_t^1$ the price of the first option and by $C_t^2$ the price of the second, we must have:
        \begin{equation*}
            C_t^2 - C_t^1 = S_t^2 - S_t^1.
        \end{equation*}
        The situation can be summarized as follows:
        \begin{center}
            \begin{tabular}{c | c c c}
            \hline \hline
                   &  time $t$  & \multicolumn{2}{c}{\multirow{1}{*}{time $T$}}  \\
                   & & $S_T^1>S_T^2$ & $S_T^2>S_T^1$\\
            \hline
            Buy option 1   &  $-C_t^1$ & $S_T^1-S_T^2$   & $0$     \\
            Sell option 2  &  $C_t^2$ & $0$  & $S_T^1-S_T^2$    \\
            \hline
            Buy $S^1$ and sell $S^2$ & $S_t^2 - S_t^1$ & $S_T^1-S_T^2$ & $S_T^1-S_T^2$\\
            \hline \hline
            \end{tabular}
        \end{center}
        
        Now suppose that this no arbitrage relation does not hold, for example $C_t^2-C_t^1 = 2$ and $S_t^2-S_t^1  = 3$. If we buy $S^1$, sell $S_2$, sell the first option and buy the second option we would realize an immediate profit of 1 and have a zero payoff at maturity. This is an example of an arbitrage opportunity.
        
        \item We set $\Tilde{C}_t = e^{-rt}F(t,S_t^1, S_t^2)$. Apply Itô's formula to $\Tilde{C}_t$ and then exploit the fact that $\Tilde{C}_t$ is a martingale to derive a PDE for the function $F$.\\\\
        The differential of $\Tilde{C}_t$ is given by
        \begin{equation*}
            d\Tilde{C}_t = -re^{-rt}F(t,S_t^1,S_t^2) dt + e^{-rt} dF(t,S_t^1, S_t^2),
        \end{equation*}
        where
        \begin{align*}
            dF(t,S_t^1,S_t^2) = &F_t dt + F_{s^1} dS_t^1 + F_{s^2} dS_t^2 + \frac{1}{2}F_{s^1s^1} dS_t^1dS_t^1 + \frac{1}{2}F_{s^2s^2} dS_t^2dS_t^2\\
            = &F_t dt + F_{s^1}S_t^1(r dt + \sigma_1 dW_t^1) + F_{s^2}S_t^2(r dt + \sigma_2 dW_t^2)\\
            &+\frac{1}{2}F_{s^1s^1}\sigma_1^2(S_t^1)^2 dt + \frac{1}{2}F_{s^2s^2}\sigma_2^2(S_t^2)^2 dt.
        \end{align*}\\
        Therefore,
        \begin{align}
            d\Tilde{C}_t = &-re^{-rt}F dt + e^{-rt} dF \nonumber\\
            = &-re^{-rt}F dt + e^{-rt}\bigg[F_t dt + F_{s^1}S_t^1(r dt + \sigma_1 dW_t^1) + F_{s^2}S_t^2(r dt + \sigma_2 dW_t^2) \nonumber\\
            &+\frac{1}{2}F_{s^1s^1}\sigma_1^2(S_t^1)^2 dt + \frac{1}{2}F_{s^2s^2}\sigma_2^2(S_t^2)^2 dt\bigg] \nonumber\\
            = &e^{-rt}\left[-rF + F_t + F_{s^1}S_t^1r + F_{s^2}S_t^2r + \frac{1}{2}F_{s^1s^1}\sigma_1^2(S_t^1)^2 + \frac{1}{2}F_{s^2s^2}\sigma_2^2(S_t^2)^2 \right] dt \nonumber\\
            &+e^{-rt}[F_{s^1}S_t^1\sigma_1 dW_t^1 + F_{s^2}S_t^2\sigma_2 dW_t^2].
        \end{align}
        Since $\Tilde{C}_t$ is a martingale, the $dt$ term must be equal to zero. This gives us a PDE for $F$:
        \begin{equation*}
            F_t = F_{s^1}S_t^1r + F_{s^2}S_t^2r + \frac{1}{2}F_{s^1s^1}\sigma_1^2(S_t^1)^2 + \frac{1}{2}F_{s^2s^2}\sigma_2^2(S_t^2)^2 = rF.
        \end{equation*}
        
        \item Comparing the dynamics of the discounted option price with the discounted value of the self-financing strategy, derive the positions in the two stocks, $H_t^1$ and $H_t^2$, in the hedging portfolio.\\\\
        Comparing the dynamics of the discounted option price (14) with the dynamics of the discounted portfolio value (12), and in particular looking at their diffusion components, we obtain $H_t^1=F_{s^1}$ and $H_t^2=F_{s^2}$, as expected.
    \end{enumerate}
    
    
\end{enumerate}



\end{frame}



\end{document}







